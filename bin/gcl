#!/usr/bin/env bash
#
# gcl: Enhanced git clone with private repo support
#
# This script clones a git repository and optionally sets up private git
# configuration if the user indicates it's a private repository.

set -euo pipefail

# Enhanced git clone with private repo support
if [[ $# -eq 0 ]]; then
    echo "Usage: gcl <repo-url> [directory]"
    exit 1
fi

# Check if we're already in a git repository
if git rev-parse --git-dir >/dev/null 2>&1; then
    echo "Error: Already in a git repository. Please run gcl from outside a git repo." >&2
    exit 1
fi

repo_url="$1"
target_dir="$2"

# Clone the repository
echo "Cloning repository..."
if [[ -n "${target_dir:-}" ]]; then
    git clone "$repo_url" "$target_dir"
    cd "$target_dir" || exit 1
else
    git clone "$repo_url"
    # Extract directory name from URL
    dir_name=$(basename "$repo_url" .git)
    cd "$dir_name" || exit 1
fi

# Ask if this is a private repository
echo
echo -n "Is this a private repository? [y/N] "
read -r reply
if [[ $reply =~ ^[Yy]$ ]]; then
    echo "Setting up private git configuration..."
    use-private-git --force
fi
